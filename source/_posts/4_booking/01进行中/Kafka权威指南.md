---
doc_type: weread-highlights-reviews
bookId: '27337544'
author: 妮哈·纳克海德 格温·沙皮拉 托德·帕利诺
cover: >-
  https://cdn.weread.qq.com/weread/cover/59/YueWen_27337544/t7_YueWen_27337544.jpg
reviewCount: 1
noteCount: 17
title: 《Kafka权威指南》
categories:
  - 4_booking
  - 01进行中
abbrlink: 813815fa
date: 2023-09-16 00:00:00
---


## 序


- 📌 我们不想只是开发一个能够存储数据的系统，比如传统的关系型数据库、键值存储引擎、搜索引擎或缓存系统，我们希望能够把数据看成是持续变化和不断增长的流，并基于这样的想法构建出一个数据系统；事实上，是一个数据架构。 
    - ⏱ 2023-09-16 11:44:47 

- 📌 作为一个现代的分布式系统，Kafka以集群的方式运行，可以自由伸缩，处理公司的所有应用程序。Kafka集群并不是一组独立运行的broker，而是一个可以灵活伸缩的中心平台，可以处理整个公司所有的数据流。其次，Kafka可以按照你的要求存储数据，保存多久都可以。 
    - ⏱ 2023-09-16 11:45:38 

- 📌 消息系统只会传递消息，而Kafka的流式处理能力让你只用很少的代码就能够动态地处理派生流和数据集。Kafka的这些独到之处足以让你刮目相看，它不只是“另一个消息队列” 
    - ⏱ 2023-09-16 11:45:57 
## 1.2 Kafka登场


- 📌 当消息以一种可控的方式写入不同的分区时，会用到键。最简单的例子就是为键生成一个一致性散列值，然后使用散列值对主题分区数进行取模，为消息选取分区。这样可以保证具有相同键的消息总是被写到相同的分区上 
    - ⏱ 2023-09-16 11:48:01 

- 📌 Kafka的消息通过主题进行分类。主题就好比数据库的表，或者文件系统里的文件夹。主题可以被分为若干个分区，一个分区就是一个提交日志。消息以追加的方式写入分区，然后以先入先出的顺序读取。要注意，由于一个主题一般包含几个分区，因此无法在整个主题范围内保证消息的顺序，但可以保证消息在单个分区内的顺序 
    - ⏱ 2023-09-16 11:49:14 

- 📌 Kafka通过分区来实现数据冗余和伸缩性。分区可以分布在不同的服务器上，也就是说，一个主题可以横跨多个服务器，以此来提供比单个服务器更强大的性能 
    - ⏱ 2023-09-16 11:49:30 

- 📌 人们把一个主题的数据看成一个流，不管它有多少个分区。 
    - ⏱ 2023-09-16 11:49:56 

- 📌 一般情况下，一个消息会被发布到一个特定的主题上。生产者在默认情况下把消息均衡地分布到主题的所有分区上，而并不关心特定消息会被写到哪个分区。不过，在某些情况下，生产者会把消息直接写到指定的分区。这通常是通过消息键和分区器来实现的，分区器为键生成一个散列值，并将其映射到指定的分区上。这样可以保证包含同一个键的消息会被写到同一个分区上。 
    - ⏱ 2023-09-16 11:51:02 

- 📌 消费者订阅一个或多个主题，并按照消息生成的顺序读取它们。消费者通过检查消息的偏移量来区分已经读取过的消息。偏移量是另一种元数据，它是一个不断递增的整数值，在创建消息时，Kafka会把它添加到消息里。在给定的分区里，每个消息的偏移量都是唯一的。消费者把每个分区最后读取的消息偏移量保存在Zookeeper或Kafka上，如果消费者关闭或重启，它的读取状态不会丢失。 
    - ⏱ 2023-09-16 11:51:33 
 

- 📌 一个独立的Kafka服务器被称为broker。broker接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。broker为消费者提供服务，对读取分区的请求作出响应，返回已经提交到磁盘上的消息。根据特定的硬件及其性能特征，单个broker可以轻松处理数千个分区以及每秒百万级的消息量。 
    - ⏱ 2023-09-16 12:00:20 

- 📌 在集群中，一个分区从属于一个broker，该broker被称为分区的首领。一个分区可以分配给多个broker，这个时候会发生分区复制（见图1-7）。这种复制机制为分区提供了消息冗余，如果有一个broker失效，其他broker可以接管领导权。 
    - ⏱ 2023-09-16 12:01:55 

- 📌 保留消息（在一定期限内）是Kafka的一个重要特性。Kafka broker默认的消息保留策略是这样的：要么保留一段时间（比如7天），要么保留到消息达到一定大小的字节数（比如1GB）。当消息数量达到这些上限时，旧消息就会过期并被删除，所以在任何时刻，可用消息的总量都不会超过配置参数所指定的大小。 
    - ⏱ 2023-09-16 12:02:12 
## 1.3 为什么选择Kafka


- 📌 Kafka也支持多个消费者从一个单独的消息流上读取数据，而且消费者之间互不影响。这与其他队列系统不同，其他队列系统的消息一旦被一个客户端读取，其他客户端就无法再读取它。另外，多个消费者可以组成一个群组，它们共享一个消息流，并保证整个群组对每个给定的消息只处理一次。 
    - ⏱ 2023-09-16 12:05:15 

- 📌 每个主题可以设置单独的保留规则，以便满足不同消费者的需求，各个主题可以保留不同数量的消息。消费者可能会因为处理速度慢或突发的流量高峰导致无法及时读取消息，而持久化数据可以保证数据不会丢失。消费者可以在进行应用程序维护时离线一小段时间，而无需担心消息丢失或堵塞在生产者端。消费者可以被关闭，但消息会继续保留在Kafka里。消费者可以从上次中断的地方继续处理消息。 
    - ⏱ 2023-09-16 12:05:46 

- 📌 用户在开发阶段可以先使用单个broker，再扩展到包含3个broker的小型开发集群，然后随着数据量不断增长，部署到生产环境的集群可能包含上百个broker。对在线集群进行扩展丝毫不影响整体系统的可用性。也就是说，一个包含多个broker的集群，即使个别broker失效，仍然可以持续地为客户提供服务。要提高集群的容错能力，需要配置较高的复制系数。 
    - ⏱ 2023-09-16 12:06:15 
## 1.5 起源故事


- 📌 他们的主要目标如下：· 使用推送和拉取模型解耦生产者和消费者；· 为消息传递系统中的消息提供数据持久化，以便支持多个消费者；· 通过系统优化实现高吞吐量；· 系统可以随着数据流的增长进行横向扩展。 
    - ⏱ 2023-09-16 12:10:24 

# 读书笔记

## 1.2 Kafka登场

### 划线评论
- 📌 消费者是消费者群组的一部分，也就是说，会有一个或多个消费者共同读取一个主题。群组保证每个分区只能被一个消费者使用。图1-6所示的群组中，有3个消费者同时读取一个主题。其中的两个消费者各自读取一个分区，另外一个消费者读取其他两个分区。消费者与分区之间的映射通常被称为消费者对分区的所有权关系  ^225207353-7LgydHzNb
    - 💭 一个主题的分区，只能被消费组内一个消费者消费。
    - ⏱ 2023-09-16 11:59:40
   

# 本书评论
