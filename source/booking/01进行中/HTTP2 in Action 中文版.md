---
doc_type: weread-highlights-reviews
bookId: "32517945"
author: Barry Pollard
cover: https://cdn.weread.qq.com/weread/cover/50/YueWen_32517945/t7_YueWen_32517945.jpg
reviewCount: 1
noteCount: 33
readingStatus: 在读
progress: 48%
totalReadDay: 6
readingTime: 0小时58分钟
readingDate: 2024-02-07
isbn: 9787121386718
title: 《HTTP/2 in Action 中文版》
date: 2024-03-26

---

![ HTTP/2 in Action 中文版|200](https://cdn.weread.qq.com/weread/cover/50/YueWen_32517945/t7_YueWen_32517945.jpg)


#### 1.1 万维网的原理


- 📌 由于因特网是全球性的，所以大公司通常会把服务器部署在世界各地。我们在向DNS查询IP地址时，通常会得到一个距离你最近的服务器的IP地址，以便你能快速访问。同样访问www.google.com，在美国的人和在欧洲的人很可能会得到不同的IP地址，这是很正常的。 
    - ⏱ 2024-02-07 23:57:55 

- 📌 第5个版本被指定为Internet Stream Protocol，其主要在实时音频和视频流应用中使用，与VoIP（Voice over IP，IP语音）后来的发展类似。可是，这个版本一直没启用，原因之一就是存在与第4版一样的地址限制。后来第6版出来的时候，第5版的工作被叫停，于是IPv6就成了IPv4的后续版本。 
    - ⏱ 2024-02-08 00:01:01 

- 📌 假如IPv6还有后续版本，很可能会是IPv10或更高的版本。到时候，无疑还会导致与今天类似的疑惑。 
    - ⏱ 2024-02-08 00:01:10 
#### 1.2 什么是HTTP


- 📌 Telnet是一个简单的应用程序，它可以创建到服务器的TCP/IP连接，然后你就能以文本形式输入命令，并查看响应。 
    - ⏱ 2024-02-08 00:03:54 
#### 1.3 HTTP的语法和历史


- 📌 HEAD方法允许客户端获取资源的所有元信息（例如HTTP头）而无须下载资源本身。在很多场景下，此方法很有用。例如，Google的网络爬虫可以检查资源是否已被更改并仅在其改变时才下载，从而为Google和目标Web服务器节省资源。 
    - ⏱ 2024-02-08 00:07:07 

- 📌 HTTP/1.1做了进一步的改进，以便充分利用HTTP协议（例如，持久连接、强制响应首部、更好的缓存选项和分块编码）。 
    - ⏱ 2024-02-08 00:08:39 

- 📌 将Host作为必选项是HTTP/1.1的重要改进，这使得服务器能够充分利用虚拟主机托管技术，无须顾及因为新增网站而新加独立主机所带来的复杂性，从而使得网络繁荣发展。另外，如果没有这个改进，我们会更早遭遇IPv4的IP地址不足的限制。 
    - ⏱ 2024-02-08 00:10:17 

- 📌 客户端或服务器可以在任何时候关闭HTTP连接。关闭可能会意外发生（由于网络连接错误）或有意为之（例如，如果暂时不使用连接，那么服务器可以关闭连接以释放资源供其他连接使用）。因此，即使使用持久连接，客户端和服务器也应该监视连接并处理意外关闭的连接。一些请求会使情况变得更复杂。例如，你在电子商务网站上结账，你不会想要重复发起请求。 
    - ⏱ 2024-02-08 00:12:15 

- 📌 曾经有一个惯例，是在这些首部中包含一个X-来表明它们没有被正式标准化（X-Content-Type、X-Frame-Options或X-XSS-Protection），但这个约定已经不推荐使用了[21]，这就导致新的实验性首部很难与HTTP/1.1规范中的首部区分开来。 
    - ⏱ 2024-02-08 00:13:51 
#### 1.4 HTTPS简介


- 📌 HTTPS使用公钥加密，服务器在用户首次连接时以数字证书的形式提供公钥。你的浏览器使用此公钥加密消息，只有服务器可以解密，因为只有它拥有配对的私钥。 
    - ⏱ 2024-02-08 04:05:31 
#### 2.1 HTTP/1.1和当前的万维网


- 📌 超过80％的时间用于等待消息在网络上传送。在此期间，Web浏览器和Web服务器都没有做太多事情，这段时间被浪费了，这是HTTP协议的一个主要问题。 
    - ⏱ 2024-02-08 04:08:12 

- 📌 HTTP/1.1尝试引入管道化，从而在收到响应之前并发发出请求，实现并行发送请求。初始的HTML仍然需要单独请求，但是当浏览器知道它需要两个图像时，它可以先后连续发出两个请求。 
    - ⏱ 2024-02-08 04:09:06 

- 📌 管道化技术应该会对HTTP带来巨大的性能改善，但由于多种原因，它很难实现，易于出错，并且没有获得Web浏览器和Web服务器的良好支持[6]。因此，它很少被使用。没有一个主流的Web浏览器支持管道化技术[7]。
即使管道化技术得到了更好的支持，它仍然需要按照请求的顺序返回响应。如果图像2可用，但必须从另一台服务器获取图像1，则图像2的响应会等待，即使应该可以立即发送图像2。此问题被称为队头（HOL）阻塞问题，在其他网络协议及HTTP中很常见 
    - ⏱ 2024-02-08 04:09:38 
#### 2.2 解决HTTP/1.1性能问题的方案


- 📌 打开多个连接是解决HTTP/1.1阻塞问题的最简单方法，这样可以同时开启多个HTTP请求。另外，与管道化技术不同，该技术不会导致HOL阻塞，因为每个HTTP连接都独立于其他HTTP连接。因此，大多数浏览器可以为每个域名打开6个连接。 
    - ⏱ 2024-02-26 09:16:43 

- 📌 使用多个HTTP连接听起来不错，但它也有缺点。当开启多个HTTP连接时，客户端和服务器都有额外的开销：打开TCP连接需要时间，维护连接需要更多的内存和CPU资源。 
    - ⏱ 2024-03-22 09:18:11 

- 📌 开启多个TCP连接并不是解决HTTP/1问题的满意方案，尽管在没有更好的解决方案时，它确实可以提升性能。另外，这也说明了为什么浏览器限制每个域名开启的连接数为6。尽管可以增大这个数字（一些浏览器允许这么做），但考虑到每个连接的额外开销，收益会比较低。 
    - ⏱ 2024-03-22 09:19:18 
#### 2.5 从HTTP/1.1到HTTP/2


- 📌 Google地位超然，既拥有一个主流浏览器（Chrome），又手握一些流行的网站（如www.google.com），所以它可以在服务器和浏览器端实现新的协议，并在线上做更大规模的实验。2010年9月，Chrome开始支持SPDY，到2011年，所有的Google服务都添加了对SPDY的支持[18]——无论从哪方面看，这个过程都堪称迅速。 
    - ⏱ 2024-03-22 09:21:23 

- 📌 2012年11月，基于SPDY发布了HTTP/2初稿[21]。在接下来的两年内，人们对此稿进行了一些细节上的改善（特别是关于流和压缩的使用） 
    - ⏱ 2024-03-22 09:21:55 
#### 3.1 HTTP/2的支持


- 📌 许多参与方都要求强制将HTTPS作为规范的一部分。后来，这个要求被排除在HTTP/2的正式规范之外，但是所有浏览器厂商都表示，他们将仅支持基于HTTPS的HTTP/2，这使其成为事实上的标准。 
    - ⏱ 2024-03-22 09:23:38 

- 📌 客户端不支持HTTP/2时，网站仍然能正常工作，因为它们可以降级到HTTP/1.1。HTTP/1.1距离被废弃（如果会的话）还很遥远。从理论上讲，如果可能，应该启用HTTP/2，因为并没有客户端不支持的问题。 
    - ⏱ 2024-03-22 09:25:20 
#### 3.2 网站开启HTTP/2的方法


- 📌 另一个实现HTTP/2的选择，是在主Web服务器前放置一个支持HTTP/2的反向代理服务器，然后它就可以将用户的HTTP/2请求转换为HTTP/1.1请求，发送给Web服务器， 
    - ⏱ 2024-03-22 09:25:59 

- 📌 CDN是非常有效的反向代理。在HTTP/2出现之前，CDN主要用于解决性能问题，而现在它们还为升级HTTP/2提供了一个简单方法。 
    - ⏱ 2024-03-22 09:28:14 
#### 3.3 常见问题


- 📌 Apache通常会在重启时，向错误日志添加一行记录，详细说明正在运行的OpenSSL版本：
￼
或者，可以针对mod_ssl模块运行ldd，查看它链接的版本：
￼
对于Nginx，可以使用-V选项来查看构建参数： 
    - ⏱ 2024-03-22 09:29:08 
#### 4.1 为什么是HTTP/2而不是HTTP/1.2


- 📌 新版本的协议与原来的协议有很大的不同，新增了如下概念：
• 二进制协议
• 多路复用
• 流量控制功能
• 数据流优先级
• 首部压缩
• 服务端推送
以上这些概念（本章会详细介绍）是新协议根本上的变化，不向前兼容。HTTP/1.0的Web服务器可以支持HTTP/1.1的消息，并可以忽略后来的版本中新增的功能，但在HTTP/2中，就不能兼容了，HTTP/2使用了不同的数据结构和格式。出于这个原因，HTTP/2被视为主版本更新。 
    - ⏱ 2024-03-22 09:30:03 

- 📌 HTTP/2允许在单个连接上同时执行多个请求，每个HTTP请求或响应使用不同的流。通过使用二进制分帧层，给每个帧分配一个流标识符，以支持同时发出多个独立请求。当接收到该流的所有帧时，接收方可以将帧组合成完整消息。
帧是同时发送多个消息的关键。每个帧都有标签表明它属于哪个消息（流），这样在一个连接上就可以同时有两个、三个甚至上百个消息。不像在HTTP/1中，大多数浏览器只能并发6个请求 
    - ⏱ 2024-03-22 09:32:07 

- 📌 这里要说的重点是，HTTP/2连接在请求发出后不需要阻塞到响应返回（如第2章中所述，HTTP/1.1会阻塞）。 
    - ⏱ 2024-03-22 09:32:37 

- 📌 服务器发送响应的顺序完全取决于服务器，但客户端可以指定优先级。如果可以发送多个响应，则服务器可以进行优先级排序，先发送重要资源（例如CSS和JavaScript），然后是不太重要的资源（例如图像）。 
    - ⏱ 2024-03-22 09:32:54 

- 📌 为了防止流ID冲突，客户端发起的请求使用奇数流ID（这就是为什么我们在前面的图中使用的流ID为5、7和9，在此连接上已经使用过流1和流3），服务器发起的请求使用偶数流ID。请注意，在写作本书时，从技术上讲服务器不能新建一个流，除非是特殊情况（服务端推送，但也要客户端先发起请求）， 
    - ⏱ 2024-03-22 09:33:09 

- 📌 在HTTP/2之前，HTTP是单独的请求-响应协议，因此没有在协议中进行优先级排序的必要。客户端（通常是Web浏览器）在HTTP之外就决定了请求的优先级，因为同时只能发送有限数量（通常为6个）的HTTP/1请求。这种优先级通常需要先请求关键资源（HTML、影响渲染的CSS和JavaScript），然后再请求非阻塞的内容（如图像和异步JavaScript）。请求会进入队列，等待可用的HTTP/1连接，而队列的优先级由浏览器管理。 
    - ⏱ 2024-03-22 09:34:32 

- 📌 现在HTTP/2对并发的请求数量的限制放宽了很多（在许多实现中，默认情况下允许同时存在100个活跃的流），因此许多请求不再需要浏览器来排队，可以立即发送它们。这可能导致带宽浪费在较低优先级的资源（例如图像）上，从而导致在HTTP/2下页面的加载速度变慢。所以需要控制流的优先级，使用更高的优先级发送最关键的资源。流的优先级控制是通过这种方式实现的：当数据帧在排队时，服务器会给高优先级的请求发送更多的帧。流优先级的控制力比HTTP/1强大，在HTTP/1中，不同的连接是互相独立的，没有优先级关系。在HTTP/1中，无法指定一些连接的优先级。如果你有5个关键资源，和1个非关键资源，则在HTTP/1下，所有资源都可以在6个独立的连接上以相同的优先级请求，要不然只能先发送前5个资源，第6个资源暂时不发出去。在HTTP/2下，所有5个请求都可以用适当的优先级发送，使用优先级决定给每个响应分配多少资源。 
    - ⏱ 2024-03-22 09:35:09 

- 📌 HTTP/2服务端推送是HTTP协议中的新概念，如果使用不当，它很容易浪费带宽 
    - ⏱ 2024-03-22 09:35:55 
#### 4.2 如何创建一个HTTP/2连接


- 📌 一个绿色的锁头并不意味着网站合法、安全——仅代表你和网站服务器之间的连接经过了加密。 
    - ⏱ 2024-03-26 09:18:17 
#### 5.1 什么是HTTP/2服务端推送


- 📌 诸如WebSockets和服务器发送事件（SSE）之类的技术真正允许双向流，HTTP/2中不是真正的双向流，一切都仍然是从客户端请求发起的。推送资源是为了响应初始请求而做出的额外响应。完成该初始请求后，流会被关闭，除非客户端发起其他请求，否则不能推送其他资源。因此，按照HTTP/2推送现在的规范，它不是WebSockets或SSE的替代品，但如果以后它进一步扩展的话，也许有替代它们的机会 
    - ⏱ 2024-03-26 09:25:35 

# 读书笔记

## 2.1 HTTP/1.1和当前的万维网

### 划线评论
> 📌 如果图像2可用，但必须从另一台服务器获取图像1，则图像2的响应会等待，即使应该可以立即发送图像2。此问题被称为队头（HOL）阻塞问题，在其他网络协议及HTTP中很常见。  ^225207353-7OOCl9ado
    - 💭 这个是http队头阻塞
    - ⏱ 2024-02-08 04:10:06
   

# 本书评论
